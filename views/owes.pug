extends layout.pug

block scripts
	script.
		$(function() {
			$('#showPaybackModalButton').click(function() {
				$('#addPaybackFailedAlert').hide();
			});

			$('#registerPaybackButton').click(function() {
				$.ajax({
					url: '/cake/payback',
					type: 'PUT',
					data: $('#paybackForm').serialize(),
					contentType: 'application/x-www-form-urlencoded',
					success: function(response) {
						location.reload();
					},
					error: function(error) {
						console.log(error);

						var alert = $('#addPaybackFailedAlert');
						alert.show();
						alert.text('Unable to add payback, ' + error.responseText);

						$('#registerPaybackModal').modal('toggle');
					}
				});				
			});
		});

block content
	div(id='addPaybackFailedAlert' class='alert alert-danger' role='alert' hidden='true').
		Unable to add payback. See log for details

	h2 Owes
	p.
		This table shows which players owe eachother items for lost matches
	table(class='table table-striped table-bordered')
		thead
			tr
				th Ower
				th Owee
				th Item
				th Amount
		tbody
			each player in owes
				each owe in player.owes
					tr
						td= player.name
						td= owe.owee.name
						td= owe.item
						td= owe.amount

	h2 Payback Log
	p This is an overview showing payback between players

	//- table(class='table table-striped table-bordered')
	//- 	thead
	//- 		tr
	//- 			th When
	//- 			th Payer
	//- 			th Payee
	//- 			th Item
	//- 	tbody
	//- 		each payback in owes.paybacks
	//- 			tr
	//- 				td(class='col-md-3')= payback.when
	//- 				td= payback.payer
	//- 				td= payback.payee
	//- 				td= payback.item

	button(type='button' class='btn btn-block btn-primary' id='showPaybackModalButton' data-toggle='modal' data-target='#registerPaybackModal') Register Payback
	div(class='modal fade' id='registerPaybackModal' tabindex='-1' role='dialog' aria-labelledby='registerPaybackModalLabel')
		div(class='modal-dialog' role='document')
			div(class='modal-content')
				div(class='modal-header')
					button(type='button' class='close' data-dismiss='modal' aria-label='Close')
						span(aria-hidden='true') &times;
					h4(class='modal-title' id='registerPaybackModalLabel') Register Payback between two player
				div(class='modal-body')
					// form(id='paybackForm')
					form(action='/cake/payback' method='PUT' id='paybackForm')
						div(class='form-group')
							p Ower
							each player in owes
								label(for='owerSelector' class='radio-inline control-label')= player.name
								input(id='owerSelector' type='radio' name='ower' value=player._id)
						div(class='form-group')
							p Owee
							each player in owes
								label(for='oweeSelector' class='radio-inline control-label')= player.name
								input(id='oweeSelector' type='radio' name='owee' value=player._id)
						div(class='form-group')
							label(for='amountInput' class='control-label') Amount
								input(type='number' name='paybackAmount' min='0' step='1' class='form-control' value=1 id='paybackAmount')
						div(class='form-group')
							label(for='paybackItem') Item:
							select(class='form-control' name='paybackItem' id='paybackItem')
								option Cake
								option Beer
					div(class='modal-footer')
						button(type='button' class='btn btn-default' data-dismiss='modal') Close
						button(type='submit' name='submit' class='btn btn-primary' id='registerPaybackButton') Register
