extends layout.pug

block scripts
	script.
		$(function () {
			$('.edit-visit').click(function () {
				var visitNumber = $(this).data('visit');

				var firstDartField = $('#first-dart-visit-' + visitNumber);
				var secondDartField = $('#second-dart-visit-' + visitNumber);
				var thirdDartField = $('#third-dart-visit-' + visitNumber);

				var firstDartMultiplierField = $('#first-dart-multiplier-visit-' + visitNumber);
				var secondDartMultiplierField = $('#second-dart-multiplier-visit-' + visitNumber);
				var thirdDartMultiplierField = $('#third-dart-multiplier-visit-' + visitNumber);

				var firstDartValue = firstDartField.data('score');
				var secondDartValue = secondDartField.data('score');
				var thirdDartValue = thirdDartField.data('score');

				var firstDartMultiplierValue = firstDartMultiplierField.data('multiplier');
				var secondDartMultiplierValue = secondDartMultiplierField.data('multiplier');
				var thirdDartMultiplierValue = thirdDartMultiplierField.data('multiplier');

				firstDartField.text('').append('<input type="text" value="' + firstDartValue + '" class="form-control" style="max-width: 50px;" />');
				secondDartField.text('').append('<input type="text" value="' + secondDartValue + '" class="form-control" style="max-width: 50px;" />');
				thirdDartField.text('').append('<input type="text" value="' + thirdDartValue + '" class="form-control" style="max-width: 50px;" />');

				firstDartMultiplierField.text('').append('<input type="text" value="' + firstDartMultiplierValue + '" class="form-control" style="max-width: 50px;" />');
				secondDartMultiplierField.text('').append('<input type="text" value="' + secondDartMultiplierValue + '" class="form-control" style="max-width: 50px;" />');
				thirdDartMultiplierField.text('').append('<input type="text" value="' + thirdDartMultiplierValue + '" class="form-control" style="max-width: 50px;" />');
			});
		});

block content
	h2 Results

	p.
		ID: #{match.id} <br>
		Started: #{match.created_at} <br>
		Finished: #{match.end_time === undefined ? '' : match.end_time} <br>
		Duration: #{((Date.parse(match.end_time)/1000 - Date.parse(match.created_at)/1000) / (60)).toFixed()} minutes <br>
		Stakes: #{match.stake === "" ? "None" : match.stake}
	
	table(class='table table-striped table-bordered')
		thead
			tr
				th Player
				th Darts Thrown
				th First 9 PPD
				th PPD
				th Scores
				th Winner
		tbody
			each player in players
				- var statistics = player.statistics;
				tr
					td
						p= player.name
					td
						p= statistics.darts_thrown
					td
						p= statistics.first_nine_ppd.toFixed(2)
					td
						p= statistics.ppd.toFixed(2)
					td
						p= statistics['60s_plus'] === 0 ? "" : "60+: " + statistics['60s_plus']
						p= statistics['100s_plus'] === 0 ? "" : "100+: " + statistics['100s_plus']
						p= statistics['140s_plus'] === 0 ? "" : "140+: " + statistics['140s_plus']
						p= statistics['180s'] === 0 ? "" : "180:  " + statistics['180s']

					if match.winner_id !== undefined && player.id === match.winner_id
						td
							span(class='glyphicon glyphicon-ok' aria-hidden='true')
					else
						td
	p.
		Starting score was #{match.starting_score}, and a total of #{scores.length * 3} darts were thrown by #{Object.keys(players).length} players

	table(class='table table-striped table-bordered' id='table-match-visits')
		thead
			tr
				th Player
				th(colspan='3') First Dart
				th(colspan='3') Second Dart
				th(colspan='3') Third Dart
				th Total
				th PPD
				th(class="txt-center") Options
		tbody
			each throws in scores
				tr(id="visit-" + throws.id)
					td= players[throws.player_id].name
					td(id='first-dart-visit-' + throws.id data-score=throws.first_dart)= throws.first_dart
					td(id='first-dart-multiplier-visit-' + throws.id data-multiplier=throws.first_dart_multiplier)= throws.first_dart_multiplier
					td
						label(class='btn btn-success')= throws.first_dart * throws.first_dart_multiplier
					td(id='second-dart-visit-' + throws.id data-score=throws.second_dart)= throws.second_dart
					td(id='second-dart-multiplier-visit-' + throws.id data-multiplier=throws.second_dart_multiplier)= throws.second_dart_multiplier
					td
						label(class='btn btn-success')= throws.second_dart * throws.second_dart_multiplier
					td(id='third-dart-visit-' + throws.id data-score=throws.third_dart)= throws.third_dart
					td(id='third-dart-multiplier-visit-' + throws.id data-multiplier=throws.third_dart_multiplier)= throws.third_dart_multiplier
					td
						label(class='btn btn-success')= throws.third_dart * throws.third_dart_multiplier
					td= (throws.first_dart * throws.first_dart_multiplier) + (throws.second_dart * throws.second_dart_multiplier) + (throws.third_dart * throws.third_dart_multiplier)
					td= (((throws.first_dart * throws.first_dart_multiplier) + (throws.second_dart * throws.second_dart_multiplier) + (throws.third_dart * throws.third_dart_multiplier)) / 3).toFixed(2)
					td(class="txt-center")
						button(type="button" class="btn btn-default edit-visit" data-visit=throws.id)
							span(class="glyphicon glyphicon-edit" aria-hidden="true")
